# TimeStop 自动备份与恢复系统

这个目录包含了用于 TimeStop 项目的自动备份和恢复脚本，以保护您的代码免于意外损失。此系统每 4 小时自动保存一次项目状态，并提供了在需要时恢复代码的工具。

## 脚本说明

### 1. 自动备份脚本 (`auto_backup.sh`)

此脚本会自动保存未提交的更改，主要用于定时任务。每次执行时，它会：

- 检查工作目录是否有未提交的更改
- 如果有更改，创建一个带有时间戳的新提交
- 创建或更新每日备份分支
- 如果配置了远程仓库，尝试推送更改

**自动备份提交格式**：`AUTO-BACKUP: 自动保存 [分支名] @ 时间戳`

### 2. 设置自动备份 (`setup_auto_backup.sh`)

用于设置每 4 小时自动运行备份的 cron 任务。执行此脚本会：

- 将 `auto_backup.sh` 添加到当前用户的 crontab
- 确保备份日志被保存到项目的 `logs` 目录
- 显示当前设置的定时任务

**使用方法**：
```bash
./setup_auto_backup.sh
```

### 3. 手动备份脚本 (`manual_backup.sh`)

用于在关键时刻手动创建备份点。此脚本允许您：

- 添加自定义的备份描述
- 选择是否创建额外的备份分支
- 选择是否将备份推送到远程仓库

**使用方法**：
```bash
./manual_backup.sh "备份描述"  # 描述是可选的
```

**手动备份提交格式**：`MANUAL-BACKUP: 备份描述 [分支名] @ 时间戳`

### 4. 从备份恢复 (`restore_from_backup.sh`)

当需要恢复到之前的备份点时使用。此脚本会：

- 自动创建当前状态的安全备份分支（以防恢复过程出错）
- 列出所有可用的备份分支和备份提交
- 提供从备份分支或备份提交恢复的选项
- 询问是否要将恢复的内容合并回原分支

**使用方法**：
```bash
./restore_from_backup.sh
```

## 典型使用场景

### 设置自动备份

1. 确保已正确安装 Git
2. 执行以下命令：
   ```bash
   cd /path/to/TimeStop
   ./scripts/setup_auto_backup.sh
   ```
3. 系统将每 4 小时自动备份一次项目状态

### 重要更改前进行手动备份

1. 在进行重大更改前，执行：
   ```bash
   ./scripts/manual_backup.sh "重构前的最终版本"
   ```
2. 根据提示选择是否创建备份分支和推送

### 从意外代码损坏中恢复

1. 如果代码出现问题，执行：
   ```bash
   ./scripts/restore_from_backup.sh
   ```
2. 选择要恢复的备份点（分支或提交）
3. 按照提示完成恢复操作

## 注意事项

- 备份系统会创建许多提交和分支，可能会增加仓库大小
- 如果不再需要某些较早的备份，可以手动删除相应的分支
- 请确保服务器或本地电脑的时间设置正确，以便准确记录备份时间
- 强烈建议将备份推送到远程仓库，以防本地环境出现问题 