# TimeStop 自动备份与恢复系统

这个目录包含了用于 TimeStop 项目的自动备份和恢复脚本，以保护您的代码免于意外损失。此系统每 4 小时自动保存一次项目状态，并提供了在需要时恢复代码的工具。

## 脚本说明

### 1. 自动备份脚本 (`auto_backup.sh`)

此脚本会自动保存未提交的更改，主要用于定时任务。每次执行时，它会：

- 检查工作目录是否有未提交的更改
- 如果有更改，创建一个带有时间戳的新提交
- 创建或更新每日备份分支
- 如果配置了远程仓库，尝试推送更改

**自动备份提交格式**：`AUTO-BACKUP: 自动保存 [分支名] @ 时间戳`

### 2. 设置自动备份 (`setup_auto_backup.sh`)

用于设置每 4 小时自动运行备份的 cron 任务。执行此脚本会：

- 将 `auto_backup.sh` 添加到当前用户的 crontab
- 确保备份日志被保存到项目的 `logs` 目录
- 显示当前设置的定时任务

**使用方法**：
```bash
./setup_auto_backup.sh
```

### 3. 手动备份脚本 (`manual_backup.sh`)

用于在关键时刻手动创建备份点。此脚本允许您：

- 添加自定义的备份描述
- 选择是否创建额外的备份分支
- 选择是否将备份推送到远程仓库

**使用方法**：
```bash
./manual_backup.sh "备份描述"  # 描述是可选的
```

**手动备份提交格式**：`MANUAL-BACKUP: 备份描述 [分支名] @ 时间戳`

### 4. 从备份恢复 (`restore_from_backup.sh`)

当需要恢复到之前的备份点时使用。此脚本会：

- 自动创建当前状态的安全备份分支（以防恢复过程出错）
- 列出所有可用的备份分支和备份提交
- 提供从备份分支或备份提交恢复的选项
- 询问是否要将恢复的内容合并回原分支

**使用方法**：
```bash
./restore_from_backup.sh
```

## 典型使用场景

### 设置自动备份

1. 确保已正确安装 Git
2. 执行以下命令：
   ```bash
   cd /path/to/TimeStop
   ./scripts/setup_auto_backup.sh
   ```
3. 系统将每 4 小时自动备份一次项目状态

### 重要更改前进行手动备份

1. 在进行重大更改前，执行：
   ```bash
   ./scripts/manual_backup.sh "重构前的最终版本"
   ```
2. 根据提示选择是否创建备份分支和推送

### 从意外代码损坏中恢复

1. 如果代码出现问题，执行：
   ```bash
   ./scripts/restore_from_backup.sh
   ```
2. 选择要恢复的备份点（分支或提交）
3. 按照提示完成恢复操作

## 注意事项

- 备份系统会创建许多提交和分支，可能会增加仓库大小
- 如果不再需要某些较早的备份，可以手动删除相应的分支
- 请确保服务器或本地电脑的时间设置正确，以便准确记录备份时间
- 强烈建议将备份推送到远程仓库，以防本地环境出现问题

# TimeStop 项目工具脚本

本目录包含TimeStop项目的辅助工具脚本，帮助自动化常见任务。

## 自动更新README.md

TimeStop项目已配置了Git钩子，用于自动更新README.md文件中的版本历史记录：

1. `pre-push` 钩子：在推送前检查最新标签，如果README.md中尚未记录该标签，则自动添加。
2. `post-commit` 钩子：在提交后检查提交信息，如果包含版本相关关键词，自动更新README.md。

这些钩子脚本位于项目的`.git/hooks/`目录下。

## 手动更新README.md

如果需要手动更新README.md的版本历史，可以使用`update_readme.sh`脚本：

```bash
./scripts/update_readme.sh <版本号> [注释]
```

例如：

```bash
# 使用指定注释
./scripts/update_readme.sh v1.2.6 "修复了界面问题、优化了性能"

# 使用最近一次提交的信息作为注释
./scripts/update_readme.sh v1.2.6
```

该脚本会：

1. 将注释分割成多个要点（使用"、"或"，"作为分隔符）
2. 在README.md的版本历史部分添加新版本记录
3. 如果该版本标签不存在，创建对应的Git标签
4. 提示用户如何提交和推送更改

## 最佳实践

为了保持版本历史的一致性和可读性，请遵循以下最佳实践：

1. 提交信息应当简明扼要地描述本次更改的内容
2. 使用"、"或"，"分隔不同的更改点
3. 版本号遵循语义化版本规范（Semantic Versioning）：
   - v主版本.次版本.补丁版本
   - 例如：v1.2.3

4. 保持README.md中的版本历史记录与Git标签一致 